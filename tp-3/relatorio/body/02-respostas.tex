% ---------------------------------------------------------------------------- %

\section{Questões e Respostas}
\label{sec:respostas}

% ---------------------------------------------------------------------------- %

\questao{a}{Qual o conteúdo do ficheiro \emph{/etc/resolv.conf} e para que serve essa informação?}

\noindent O ficheiro \emph{/etc/resolv.conf} possui o seguinte conteúdo:

\begin{minted}{text}
  # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
  #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
  nameserver 10.0.2.3
  search eduroam.uminho.pt
\end{minted}

Este ficheiro contém informação de configuração para o serviço de resolução de nomes de domínio empregado pelo sistema operativo. O seu conteúdo tem o seguinte significado:

\begin{itemize}

    \item A linha \path{nameserver 10.0.2.3} identifica o endereço IP do servidor de nomes que deve ser usado para servir pedidos de resolução de nomes;

    \item A linha \path{search eduroam.uminho.pt} especifica o modo de resolução de nomes que não contenham nenhum ponto (tendo em conta que a opção \path{ndots} tem o valor por defeito de 1). Por exemplo, para o nome \path{abc} e tendo em conta esta linha, deverá ser feita a tentativa de resolver o nome como \path{abc.eduroam.uminho.pt}.

\end{itemize}

% ---------------------------------------------------------------------------- %

\questao{b}{Os servidores \path{www.google.pt.} e \path{www.google.com.} têm endereços IPv6? Se sim, quais?}

\noindent Para determinar os endereços dos servidores em questão, foi utilizado o comando \path{host} da seguinte forma:

\begin{minted}{console}
    $ host www.google.pt.
    www.google.pt has address 216.58.214.163
    www.google.pt has IPv6 address 2a00:1450:4003:801::2003
    $ host www.google.com.
    www.google.com has address 172.217.16.228
    www.google.com has IPv6 address 2a00:1450:4003:803::2004
\end{minted}

Pelo output destes comandos determina-se que ambos os servidores têm, de facto, endereços IPv6:

\begin{itemize}
    \item O servidor \path{www.google.pt.} tem endereço IPv6 \path{2a00:1450:4009:809::2003};
    \item O servidor \path{www.google.com.} tem endereço IPv6 \path{2a00:1450:4009:809::2004}.
\end{itemize}

% ---------------------------------------------------------------------------- %

\questao{c}{Quais os servidores de nomes definidos para os domínios: ``\path{ccg.pt.}'', ``\path{pt.}'' e ``\path{.}''?}

\noindent Os servidores de nomes definidos para o domínio ``\path{ccg.pt.}'' são os seguintes:

\begin{itemize}
    \item \path{ns1.ccg.pt.} com endereço IPv4 \path{193.136.11.201};
    \item \path{ns3.ccg.pt.} com endereço IPv4 \path{193.136.11.203}.
\end{itemize}

\noindent Os servidores de nomes definidos para o domínio ``\path{pt.}'' são os seguintes:

\begin{itemize}
    \item \path{a.dns.pt.} com endereço IPv4 \path{185.39.208.1};
    \item \path{b.dns.pt.} com endereço IPv4 \path{194.0.25.23};
    \item \path{c.dns.pt.} com endereço IPv4 \path{204.61.216.105};
    \item \path{d.dns.pt.} com endereço IPv4 \path{185.39.210.1};
    \item \path{e.dns.pt.} com endereço IPv4 \path{193.136.192.64};
    \item \path{f.dns.pt.} com endereço IPv4 \path{162.88.45.1};
    \item \path{g.dns.pt.} com endereço IPv4 \path{193.136.2.226};
    \item \path{ns.dns.br.} com endereço IPv4 \path{200.160.0.5};
    \item \path{ns2.nic.fr.} com endereço IPv4 \path{192.93.0.4};
    \item \path{sns-pb.isc.org.} com endereço IPv4 \path{192.5.4.1}.
\end{itemize}

\noindent Os servidores de nomes definidos para o domínio ``\path{.}'' são os seguintes:

\begin{itemize}
    \item \path{a.root-servers.net.} com endereço IPv4 \path{198.41.0.4};
    \item \path{b.root-servers.net.} com endereço IPv4 \path{199.9.14.201};
    \item \path{c.root-servers.net.} com endereço IPv4 \path{192.33.4.12};
    \item \path{d.root-servers.net.} com endereço IPv4 \path{199.7.91.13};
	\item \path{e.root-servers.net.} com endereço IPv4 \path{192.203.230.10};
	\item \path{f.root-servers.net.} com endereço IPv4 \path{192.5.5.241};
	\item \path{g.root-servers.net.} com endereço IPv4 \path{192.112.36.4};
	\item \path{h.root-servers.net.} com endereço IPv4 \path{198.97.190.53};
	\item \path{i.root-servers.net.} com endereço IPv4 \path{192.36.148.17};
	\item \path{j.root-servers.net.} com endereço IPv4 \path{192.58.128.30};
	\item \path{k.root-servers.net.} com endereço IPv4 \path{193.0.14.129};
	\item \path{l.root-servers.net.} com endereço IPv4 \path{199.7.83.42};
	\item \path{m.root-servers.net.} com endereço IPv4 \path{202.12.27.33}.
\end{itemize}

% ---------------------------------------------------------------------------- %

\questao{d}{Existe o domínio \path{eureka.software.}? Será que \path{eureka.software.} é um host?}

\noindent O domínio \path{eureka.software.} existe e é um host, como se pode determinar através do output do seguinte comando:

\begin{minted}{console}
    $ nslookup
    > set type=a
    > eureka.software.
    Server:  127.0.1.1
    Address: 127.0.1.1#53

    Non-authoritative answer:
    Name:    eureka.software
    Address: 34.214.90.141
\end{minted}

% ---------------------------------------------------------------------------- %

\questao{e}{Qual é o servidor DNS primário definido para o domínio \path{ami.pt.}? Este servidor primário (\emph{master}) aceita queries recursivas? Porquê?}

\noindent O servidor DNS primário definido para o domínio \path{ami.pt.} tem endereço IPv4 \path{80.172.230.28} (\path{ns1.dot2web.com.}):

\begin{minted}{console}
    $ host -t NS ami.pt
    ami.pt name server ns1.dot2web.com.
    ami.pt name server ns2.dot2web.com.
\end{minted}

Este servidor não aceita queries recursivas, uma vez que a flag \path{RA} não está presente no seguinte header de resposta obtido através do comando \path{dig @ns1.dot2web.com google.com}:

\begin{minted}{text}
    ;; ->>HEADER<<- opcode: QUERY, status: REFUSED, id: 51127
    ;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 1
    ;; WARNING: recursion requested but not available
\end{minted}

% ---------------------------------------------------------------------------- %

\questao{f}{Obtenha uma resposta ``\emph{autoritativa}'' para a questão anterior.}

(A resposta na questão anterior é autoritativa.)

% ---------------------------------------------------------------------------- %

\questao{g}{Onde são entregues as mensagens dirigidas a \path{marcelo@presidencia.pt}? E a \path{guterres@onu.org}?}

\noindent As mensagens dirigidas a \path{marcelo@presidencia.pt} são entregues em \path{mail1.presidencia.pt.} ou \path{mail2.presidencia.pt.}:

\begin{minted}{console}
    $ dig -t MX presidencia.pt
    ; <<>> DiG 9.11.4-3ubuntu5.1-Ubuntu <<>> -t MX presidencia.pt
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 25743
    ;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 65494
    ;; QUESTION SECTION:
    ;presidencia.pt.			IN	MX
    
    ;; ANSWER SECTION:
    presidencia.pt.		86400	IN	MX	50 mail1.presidencia.pt.
    presidencia.pt.		86400	IN	MX	10 mail2.presidencia.pt.
    
    ;; Query time: 88 msec
    ;; SERVER: 127.0.0.53#53(127.0.0.53)
    ;; WHEN: sex abr 12 22:45:58 WEST 2019
    ;; MSG SIZE  rcvd: 87
\end{minted}

\noindent As mensagens dirigidas a \path{guterres@onu.org} são entregues em \path{mail.onu.org.}:

\begin{minted}{console}
    $ dig -t MX onu.org
    ; <<>> DiG 9.11.4-3ubuntu5.1-Ubuntu <<>> -t MX onu.org
    ;; global options: +cmd
    ;; Got answer:
    ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 64402
    ;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1
    
    ;; OPT PSEUDOSECTION:
    ; EDNS: version: 0, flags:; udp: 65494
    ;; QUESTION SECTION:
    ;onu.org.			IN	MX
    
    ;; ANSWER SECTION:
    onu.org.		3600	IN	MX	10 mail.onu.org.
    
    ;; Query time: 825 msec
    ;; SERVER: 127.0.0.53#53(127.0.0.53)
    ;; WHEN: sex abr 12 22:47:15 WEST 2019
    ;; MSG SIZE  rcvd: 57
\end{minted}

% ---------------------------------------------------------------------------- %

\questao{h}{Que informação é possível obter acerca de \path{www.whitehouse.gov}? Qual é o endereço IPv4 associado?}

\noindent O endereço IPv4 associado (após resolver \emph{aliases}) é modificado regularmente. No momento da escrita, o endereço IPv4 era \path{2.19.159.149}.

Realizando-se queries dos tipos A, AAAA, CNAME, MX, NS, PTR, SIG, SOA, SRV e TXT, apenas foi possível reunir a seguinte informação:

\begin{minted}{text}
    www.whitehouse.gov.	23	IN	CNAME	wildcard.whitehouse.gov.edgekey.net.
    wildcard.whitehouse.gov.edgekey.net. 313 IN CNAME e4036.dscb.akamaiedge.net.
    e4036.dscb.akamaiedge.net. 19	IN	A	23.64.18.121
    e4036.dscb.akamaiedge.net. 20	IN	AAAA	2a02:26f0:a1:297::fc4
    e4036.dscb.akamaiedge.net. 20	IN	AAAA	2a02:26f0:a1:2ba::fc4
\end{minted}

% ---------------------------------------------------------------------------- %

\questao{i}{Consegue interrogar o DNS sobre o endereço IPv6 \path{2001:690:a00:1036:1113::247} usando algum dos clientes DNS? Que informação consegue obter? Supondo que teve problemas com esse endereço, consegue obter um contacto do responsável por esse IPv6?}

\noindent Utilizando o comando \texttt{host}, determinou-se que o endereço IPv6 em questão corresponde ao endereço \path{www.fccn.pt.}. Um contato do responsável por esse endereço é \path{dns-tec@fccn.pt}.

% ---------------------------------------------------------------------------- %

\questao{j}{Os secundários usam um mecanismo designado por ``Transferência de zona'' para se atualizarem automaticamente a partir do primário, usando os parâmetros definidos no Record do tipo SOA do domínio. Descreve sucintamente esse mecanismo com base num exemplo concreto (ex: di.uminho.pt ou o domínio cc.pt que vai ser criado na topologia virtual).}

\noindent O mecanismo de transferência de zona permite replicar \emph{zonas DNS} --- porções contíguas do espaço de nomes --- entre servidores DNS. As transferência de zona são iniciadas pelos secundários; no entanto, o primário pode notificar os secundários de que foram realizadas alterações à informação da zona através de mensagens NOTIFY.

Existem dois tipos de transferência de zona: \emph{completa} e \emph{incremental}. Com transferências de zona completas, toda a informação da zona é transmitida ao servidor que iniciou a transferência. Com transferências de zona incrementais, no entanto, apenas a informação desatualizada é transmitida.

Para iniciar uma transferência de zona, o secundário começa por obter o record \emph{Start of Authority} (SOA) do primário, verificando depois se o \emph{serial number} contido nesse record é superior àquele da cópia da zona que o secundário detém. Se tal não se verificar (\emph{i.e.}, a informação no secundário está atualizada), o processo é interrompido.

Se, de facto, o \emph{serial number} obtido for superior ao atual do secundário, conclui-se que a cópia da zona detida pelo secundário está desatualizada e é iniciada então a fase de transmissão do conteúdo da zona do primário para o secundário. Para tal, no caso de se desejar efetuar uma transferência de zona completa, o secundário envia uma query de tipo AXFR ao primário, o qual responde com várias mensagens compondo os records de todos os domínios na zona. Caso se pretenda efetuar uma transferência de zona incremental, o secundário envia uma query de tipo IXFR, na qual especifica o \emph{serial number} da sua cópia da zona, após a qual o secundário responde apenas com os records dos domínios alterados desde essa versão.

Os seguintes passos representam um possível exemplo de uma transferência de zona entre o servidor de nomes primário \path{dns.di.uminho.pt} e o secundário \path{dns2.di.uminho.pt}:

\begin{enumerate}
    \item Como consequência, \path{dns2.di.uminho.pt} pede o record SOA de \path{dns.di.uminho.pt};
    \item Comparando o \emph{serial number} no record SOA com o da cópia local da zona, determina-se que a cópia está desatualizada;
    \item \path{dns2.di.uminho.pt} envia uma query AFXR a \path{dns.di.uminho.pt};
    \item \path{dns.di.uminho.pt} responde com várias mensagens compondo os records de todos os domínios na zona.
\end{enumerate}

% ---------------------------------------------------------------------------- %
